# QuillEditor → Marked 기반 에디터 마이그레이션 계획

## 📋 현재 상황 분석

### 기존 QuillEditor 분석
- **라이브러리**: react-quill (WYSIWYG 에디터)
- **사용처**: 
  - `TimerPage`: 세션 노트 작성 (expanded/disabled/animate props)
  - `NoteCreatePage`: 일반 노트 작성
- **주요 기능**:
  - 리치 텍스트 편집 (볼드, 이탤릭, 헤더 등)
  - 이미지 삽입/삭제
  - 다크/라이트 테마 지원
  - 높이 조절 가능
  - 툴바 기능

### Marked 라이브러리 특징
- **목적**: 마크다운 → HTML 변환
- **장점**: 빠른 속도, 경량, 확장성
- **보안**: DOMPurify와 함께 사용 권장
- **한계**: WYSIWYG 기능 없음 (순수 마크다운)

## 🤔 핵심 설계 결정 사항

### 1. 에디터 방식 선택
현재 QuillEditor는 **WYSIWYG** 방식이지만, marked는 **마크다운 문법** 기반입니다.

**옵션 A: 순수 마크다운 에디터**
- 텍스트 에리어에 마크다운 문법 직접 입력
- 실시간 또는 탭 방식 HTML 미리보기
- 학습 곡선 존재, 하지만 개발자 친화적

**옵션 B: 하이브리드 에디터**
- 툴바 버튼으로 마크다운 문법 자동 삽입
- 실시간 미리보기와 함께 마크다운 소스 편집
- 기존 사용자 경험과 비슷

**옵션 C: 탭 방식 에디터**
- 편집 탭 (마크다운) + 미리보기 탭 (HTML)
- GitHub 스타일과 유사

### 2. 이미지 처리 방식
기존: QuillEditor 내장 이미지 기능  
신규: 마크다운 이미지 문법 `![alt](url)` 또는 별도 업로드 UI

### 3. 기존 데이터 호환성
- 기존 HTML 콘텐츠를 마크다운으로 변환할지?
- 아니면 두 형식을 모두 지원할지?

## ✅ **사용자 결정사항 (확정)**

### Q1. 에디터 사용자 경험
- [x] **마크다운 문법으로 완전 전환** 
- 서버에서 문자열로 저장하므로 문제없음

### Q2. 이미지 기능
- [x] **서버 업로드 API + 자동 마크다운 삽입**
- 기존 서버 이미지 API를 활용하여 S3 업로드 후 링크 삽입

### Q3. 기존 데이터
- [x] **모두 마크다운으로 변환** + 가능하면 기존 내용 읽기전용 유지

### Q4. 개발 우선순위
- [x] **사용자 경험 유지** + **새로운 마크다운 기능 활용**

## 🚀 구체적인 구현 계획

### Phase 1: 기본 구조 및 의존성 설치
1. **패키지 설치**
   ```bash
   npm install marked dompurify
   npm install @types/dompurify --save-dev
   ```

2. **새로운 MarkdownEditor 컴포넌트 생성**
   - `frontend/src/components/ui/MarkdownEditor.tsx`
   - 기존 QuillEditor와 동일한 인터페이스 유지
   - 마크다운 입력 + 실시간 HTML 미리보기

3. **이미지 업로드 API 설정**
   - `frontend/src/api/imageApi.ts` 생성 (서버 API 활용)
   - S3 업로드 후 URL 반환 기능

### Phase 2: 마크다운 에디터 핵심 기능
1. **분할 레이아웃**
   - 좌측: 마크다운 편집 영역 (textarea)
   - 우측: HTML 미리보기 영역
   - 모바일에서는 탭 방식 전환

2. **실시간 렌더링**
   - marked를 사용한 마크다운 → HTML 변환
   - DOMPurify로 XSS 방지
   - 디바운스로 성능 최적화

3. **도구 모음**
   - 마크다운 문법 빠른 삽입 버튼
   - 헤더, 볼드, 이탤릭, 링크, 코드블록 등
   - 이미지 업로드 버튼

### Phase 3: 고급 기능 및 사용자 경험
1. **이미지 업로드 시스템**
   - 드래그 앤 드롭 지원
   - 클립보드 이미지 붙여넣기
   - 진행률 표시 및 에러 처리
   - 자동 마크다운 문법 삽입 `![alt](s3-url)`

2. **키보드 단축키**
   - Ctrl+B: 볼드 (`**text**`)
   - Ctrl+I: 이탤릭 (`*text*`)
   - Ctrl+K: 링크 (`[text](url)`)
   - Ctrl+Shift+V: 이미지 업로드

3. **편의 기능**
   - 마크다운 문법 자동완성
   - 라이브 타이핑으로 미리보기 동기화
   - 전체화면 모드

### Phase 4: 스타일링 및 테마
1. **기존 테마 시스템 적용**
   - MUI 다크/라이트 테마 연동
   - 기존 QuillEditor와 동일한 스타일링
   - 폰트, 색상, 간격 등 일관성 유지

2. **반응형 디자인**
   - 데스크톱: 분할 레이아웃
   - 태블릿: 조정 가능한 분할
   - 모바일: 탭 방식 (편집/미리보기)

3. **접근성**
   - 키보드 네비게이션
   - 스크린 리더 지원
   - 적절한 ARIA 레이블

### Phase 5: 데이터 마이그레이션 및 통합
1. **HTML → 마크다운 변환 유틸리티**
   - 기존 HTML 콘텐츠 분석
   - 마크다운으로 변환 (turndown 라이브러리 활용)
   - 데이터 백업 및 마이그레이션 스크립트

2. **점진적 적용**
   - MarkdownEditor를 별도 컴포넌트로 완성
   - NoteCreatePage에 우선 적용
   - TimerPage에 적용 (기존 props 호환)

3. **폴백 시스템**
   - 기존 HTML 콘텐츠는 읽기 전용으로 표시
   - 새로운 편집 시에만 마크다운으로 변환
   - 에러 발생 시 기존 QuillEditor로 폴백

### Phase 6: 테스트 및 최적화
1. **단위 테스트**
   - 마크다운 파싱 테스트
   - 이미지 업로드 테스트
   - 데이터 변환 테스트

2. **성능 최적화**
   - 대용량 텍스트 처리
   - 메모리 사용량 최적화
   - 렌더링 성능 개선

3. **사용자 테스트**
   - 기존 사용자 워크플로우 검증
   - 피드백 수집 및 개선

## 📅 예상 개발 일정
- **Week 1**: Phase 1-2 (기본 구조 및 핵심 기능)
- **Week 2**: Phase 3-4 (고급 기능 및 스타일링)
- **Week 3**: Phase 5 (마이그레이션 및 통합)
- **Week 4**: Phase 6 (테스트 및 최적화)

## 🎯 다음 단계
1. ✅ 구현 계획 확정
2. 🔄 **지금 시작**: 패키지 설치 및 기본 MarkdownEditor 컴포넌트 생성
3. 📝 이미지 업로드 API 엔드포인트 확인 필요 